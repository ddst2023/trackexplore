"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8373],{8373:function(a,b,c){c.r(b),c.d(b,{Account:function(){return C},canCreateCustomer:function(){return B},migrateFromLegacy:function(){return D}});var d,e,f,g,h,i,j,k,l,m=c(47568),n=c(26042),o=c(69396),p=c(828),q=c(34051),r=c.n(q),s=c(27429),t=c(16977),u=c(48080),v=c(9669),w=c.n(v),x=(d=(0,m.Z)(r().mark(function a(b){var d,e,f,g,h,i,j,k,l,m,q;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.t0=p.Z,a.next=4,(0,u.Z)(function(){return[Promise.resolve().then(c.t.bind(c,9669,23)),c.e(9659).then(c.bind(c,79659)),c.e(606).then(c.bind(c,80606)),]});case 4:return a.t1=a.sent,f=(e=(d=(0,a.t0)(a.t1,3))[0]).default,g=d[1].StandardToBigCommerceAddress,h=d[2].assertOAUTHCustomerUpsertAddressRequest,i=g(b),a.next=13,f.post("".concat(t.OAUTH_API,"/sf/customer/address/"),(0,o.Z)((0,n.Z)({},i),{country_code:"US"}),{headers:{"Content-Type":"application/json"}});case 13:if(l=(k=h(j=a.sent.data)).success,q=(m=k.data).find(function(a){return a.id===b.id}),!(l&&q)){a.next=18;break}return a.abrupt("return",{success:!0,newAddress:q});case 18:a.next=23;break;case 20:a.prev=20,a.t2=a.catch(0),(0,s.vU)("upsertCustomerAddress Failed",a.t2);case 23:return a.abrupt("return",{success:!1,newAddress:null});case 24:case"end":return a.stop()}},a,null,[[0,20]])})),function(a){return d.apply(this,arguments)}),y=(e=(0,m.Z)(r().mark(function a(b){var d,e,f,g,h,i,j,k,l,m,n,o,q,v,w,x,y,z,A;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.t0=p.Z,a.next=4,(0,u.Z)(function(){return[c.e(9659).then(c.bind(c,79659)),Promise.resolve().then(c.t.bind(c,9669,23)),c.e(3464).then(c.bind(c,93464)),]});case 4:return a.t1=a.sent,e=(d=(0,a.t0)(a.t1,3))[0].StandardToBigCommerceAddress,f=d[1],g=f.default,h=d[2].mapStateToFullName,j=(i=e(b)).address_type,k=i.country_code,l=i.company,m=i.first_name,n=i.last_name,o=i.state_or_province,q=i.address1,v=i.address2,w=i.postal_code,x=i.city,y=i.phone,z=i.customer_id,a.next=13,g.post("".concat(t.OAUTH_API,"/sf/customer/address/"),{address_type:j,country_code:k,company:l,first_name:m,last_name:n,state_or_province:h(o),address1:q,address2:v,postal_code:w,city:x,phone:y,customer_id:z},{headers:{"Content-Type":"application/json"}});case 13:return A=a.sent.data.success,a.abrupt("return",{success:!!A});case 17:a.prev=17,a.t2=a.catch(0),(0,s.vU)("upsertCustomerAddress Failed",a.t2);case 20:return a.abrupt("return",{success:!1});case 21:case"end":return a.stop()}},a,null,[[0,17]])})),function(a){return e.apply(this,arguments)}),z=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:500;return new Promise(function(b){return setTimeout(b,a)})},A=(f=(0,m.Z)(r().mark(function a(b){var d,e,f,g,h,i,j,k,l,m,n,o,q,v;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.email,e=b.password,f=b.attempts,g=void 0===f?0:f,a.t0=p.Z,a.next=4,(0,u.Z)(function(){return[Promise.resolve().then(c.t.bind(c,9669,23))]});case 4:return a.t1=a.sent,j=(i=(h=(0,a.t0)(a.t1,1))[0]).default,a.prev=8,(0,s.cM)("Attempting Login for user ".concat(d)),a.next=12,j.post("".concat(t.OAUTH_API,"/login"),{email:d,password:e},{maxRedirects:0});case 12:return k=a.sent.status,a.abrupt("return",{success:200===k,status:k});case 16:if(a.prev=16,a.t2=a.catch(8),(null===a.t2|| void 0===a.t2?void 0:null===(l=a.t2.response)|| void 0===l?void 0:null===(m=l.data)|| void 0===m?void 0:m.title)!=="Invalid login. Please attempt to log in again."){a.next=38;break}return(0,s.cM)("Retrying"),a.prev=21,a.next=25,z();case 25:return o=String((null===a.t2|| void 0===a.t2?void 0:null===(n=a.t2.request)|| void 0===n?void 0:n.responseURL)||""),(0,s.cM)("softRetryResponse by requesting ".concat(o)),a.next=29,j.get(o);case 29:return q=a.sent.status,a.abrupt("return",{success:200===q,status:q});case 33:a.prev=33,a.t3=a.catch(21),(0,s.cM)("Soft Retry failed trying Hard retry	".concat(String(a.t3)));case 36:a.next=39;break;case 38:return a.abrupt("return",{success:!1,status:500});case 39:if(!(g<3)){a.next=44;break}return a.next=42,A({email:d,password:e,attempts:g+1});case 42:return v=a.sent,a.abrupt("return",v);case 44:return(0,u.Z)(function(){return[c.e(6358).then(c.bind(c,56358))]}).then(function(a){var b=(0,p.Z)(a,1)[0],c=b.setContext,e=b.captureException;c("LoginFailed",{email:String(d)}),e(Error("Login Failed with valid credentials"))}).catch(s.vU),a.abrupt("return",{success:!1,status:500});case 46:case"end":return a.stop()}},a,null,[[8,16],[21,33]])})),function(a){return f.apply(this,arguments)}),B=(g=(0,m.Z)(r().mark(function a(b){return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",w().get("/api/storefront/order/".concat(b)).then(function(a){return!!a.data.customerCanBeCreated}).catch(function(){return!1}));case 1:case"end":return a.stop()}},a)})),function(a){return g.apply(this,arguments)}),C={createCustomer:(h=(0,m.Z)(r().mark(function a(b){var d,e,f;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=p.Z,a.next=3,(0,u.Z)(function(){return[Promise.resolve().then(c.t.bind(c,9669,23))]});case 3:return a.t1=a.sent,f=(e=(d=(0,a.t0)(a.t1,1))[0]).default,a.abrupt("return",f.post("".concat(t.OAUTH_API,"/sf/customer"),b));case 8:case"end":return a.stop()}},a)})),function(a){return h.apply(this,arguments)}),updateCustomerInfo:(i=(0,m.Z)(r().mark(function a(b){var d,e,f;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=p.Z,a.next=3,(0,u.Z)(function(){return[Promise.resolve().then(c.t.bind(c,9669,23))]});case 3:return a.t1=a.sent,f=(e=(d=(0,a.t0)(a.t1,1))[0]).default,a.next=9,f.post("".concat(t.OAUTH_API,"/sf/customer/edit/"),(0,o.Z)((0,n.Z)({},b),{password:b.password||b.current_password,confirm_password:b.confirm_password||b.current_password}),{headers:{"Content-Type":"application/json"}});case 9:return a.abrupt("return",a.sent.data);case 10:case"end":return a.stop()}},a)})),function(a){return i.apply(this,arguments)}),upsertCustomerAddress:x,createAddress:y,checkValidityOfAddress:(j=(0,m.Z)(r().mark(function a(b){var d,e,f,g,h,i,j,k,l;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=p.Z,a.next=3,(0,u.Z)(function(){return[c.e(3852).then(c.bind(c,93852)),c.e(9756).then(c.bind(c,83168)),c.e(3464).then(c.bind(c,93464)),]});case 3:return a.t1=a.sent,e=(d=(0,a.t0)(a.t1,3))[0].getPlacesPredictions,f=d[1].standardizeAddress,g=d[2],h=g.mapStateToAcronym,i=g.mapStateToFullName,a.next=12,e(f(b));case 12:if(k=(j=a.sent).validAddress,l=j.addressPredictions,!(!k&&!(null==l?void 0:l.length))){a.next=17;break}return a.abrupt("return",{addressValid:!1,displayMessage:"Entered address is not correct.",displayButtons:!1,suggestedAddress:null});case 17:if(!k){a.next=19;break}return a.abrupt("return",{addressValid:!0,displayMessage:"",displayButtons:!1,suggestedAddress:null});case 19:return a.abrupt("return",{displayMessage:"Did you mean: ",addressValid:!1,displayButtons:!0,suggestedAddress:(0,o.Z)((0,n.Z)({},l[0]),{stateAcronym:h(l[0].stateAcronym),state:i("".concat(l[0].stateName||"")),stateName:i("".concat(l[0].stateName||""))})});case 20:case"end":return a.stop()}},a)})),function(a){return j.apply(this,arguments)}),deleteCustomerAddress:(k=(0,m.Z)(r().mark(function a(b){var d,e,f,g;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=p.Z,a.next=3,(0,u.Z)(function(){return[Promise.resolve().then(c.t.bind(c,9669,23)),c.e(606).then(c.bind(c,80606)),]});case 3:return a.t1=a.sent,f=(e=(d=(0,a.t0)(a.t1,2))[0]).default,g=d[1].assertOAUTHCustomerAddressDeletionRequest,a.t2=g,a.next=11,f.delete("".concat(t.OAUTH_API,"/sf/customer/address/"),{headers:{"Content-Type":"application/json"},data:b});case 11:return a.t3=a.sent.data,a.abrupt("return",(0,a.t2)(a.t3));case 13:case"end":return a.stop()}},a)})),function(a){return k.apply(this,arguments)}),getCustomerInfo:(0,m.Z)(r().mark(function a(){var b,d,e,f,g,h;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=p.Z,a.next=3,(0,u.Z)(function(){return[Promise.resolve().then(c.t.bind(c,9669,23)),c.e(4639).then(c.bind(c,84639)),]});case 3:return a.t1=a.sent,e=(d=(b=(0,a.t0)(a.t1,2))[0]).default,f=b[1].assertOAUTHCustomerDataRequest,a.next=10,e.post("".concat(t.OAUTH_API,"/sf/customer/data/"));case 10:return h=f(g=a.sent.data).data,a.abrupt("return",h[0]);case 13:case"end":return a.stop()}},a)})),signUserIn:A,canCreateCustomer:B};b.default=C;var D=(l=(0,m.Z)(r().mark(function a(b){var d,e,f,g,h,i;return r().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.identifier,e=b.password,a.prev=1,a.t0=p.Z,a.next=5,(0,u.Z)(function(){return[c.e(3414).then(c.bind(c,93414)),Promise.all([c.e(2506),c.e(3714),c.e(9638),c.e(3106),c.e(6286)]).then(c.bind(c,14877)),]});case 5:return a.t1=a.sent,g=(f=(0,a.t0)(a.t1,2))[0].getSavedInstrumentsCredentials,h=f[1].ShopFront,a.next=11,g();case 11:if((i=a.sent).accessKeyId){a.next=14;break}return a.abrupt("return");case 14:return a.next=16,h({credentials:i}).migrateLegacyLoginProfile({identifier:d,password:e,shopName:t.CSC_PAYMENTS_SHOP});case 16:a.next=21;break;case 18:a.prev=18,a.t2=a.catch(1),(0,s.cM)("Customer was NOT legacy migrated.");case 21:case"end":return a.stop()}},a,null,[[1,18]])})),function(a){return l.apply(this,arguments)})}}])
//# sourceMappingURL=8373-5c2571bffff84ce7.js.map